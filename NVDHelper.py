from typing import List

from os import path

from config import NVD_DIR, NVD_FEED_ROOT, NVD_API_VERSION, NVD_YEAR_MIN

def get_nvd_years(start_date, end_date) -> List[int]:
    year_begin = max(start_date.year, NVD_YEAR_MIN)
    year_end = end_date.year
    if year_end < year_begin:
        raise ValueError(f"Start year {year_begin} is later than end year {year_end}")
    return list(range(year_begin, year_end+1))

def nvd_file_basename(year: int) -> str:
    return f"nvdcve-{NVD_API_VERSION}-{year}"

def nvd_file_name(basename: str, file_type: str) -> str:
    type2ext = {
        "json": "json",
        "zip": "json.zip",
        "meta": "meta"
    }
    # add appropriate extension, fallback to 'json' if unknown
    return f"{basename}.{type2ext.get(file_type,'json')}"

def nvd_file_path(filename: str) -> str:
    return path.join(NVD_DIR, filename)

def nvd_uri(filename: str) -> str:
    return f"{NVD_FEED_ROOT}/{NVD_API_VERSION}/{filename}"
