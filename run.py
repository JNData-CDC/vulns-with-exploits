from datetime import date, timedelta

from NVDVulnDownloader import NVDVulnDownloader
from EDBMappingDownloader import EDBMappingDownloader
from VulnsWithExploits import VulnsWithExploits

from sys import exc_info

def main():
    # for now the time range is hardcoded to be 365 days
    today = date.today()
    start_date = today - timedelta(days=365)
    
    # download list of CVEs from NVD
    nd = NVDVulnDownloader(start_date, today)    
    nd.run()

    # download the mapping file (CVE -> EDBID)
    edbd = EDBMappingDownloader()
    edbd.run()

    # run the code that gets a list of vulns in a given time range
    ve = VulnsWithExploits()
    vulns_with_exploits = ve.get_vulns_with_exploits(start_date, today)
    #DEBUG
    with open("cves.txt", "w") as fp:
        fp.write("\n".join(vulns_with_exploits))
    #DEBUG END
    

if __name__ == "__main__":
    main()
